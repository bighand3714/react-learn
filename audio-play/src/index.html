<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Play</title>
  <script src="../build/react.development.js"></script>
  <script src="../build/react-dom.development.js"></script>
  <script src="../build/babel.min.js"></script>
</head>

<body>
  <div id="root"></div>
  <script type='text/babel'>
    class AudioPlay extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          isPlay: false,
          duration: 0,
          currentTime: 0,
        }
        this.audioControl = this.audioControl.bind(this);
      }

      componentDidMount() {
        console.log(this.audio);
        this.audio.addEventListener('canplay', () => {
          // console.log('canplay');
          // console.log(this.audio.duration);
          this.setState({
            duration: parseInt(this.audio.duration),
          });
        });
        this.audio.addEventListener('timeupdate', () => {
          // console.log(this.audio.currentTime);
          this.setState({
            currentTime: parseInt(this.audio.currentTime),
          });
        });
      }

      componentDidUpdate() {
        console.log('componentDidUpdate')
      }

      audioControl(e) {
        // console.log(e.target);
        if (this.state.isPlay) {
          this.setState({
            isPlay: !this.state.isPlay,
          });
          this.audio.pause();
        } else {
          this.setState({
            isPlay: !this.state.isPlay,
          });
          this.audio.play();
        }
      }

      // 秒转换-分:秒的格式
      getTime = time => {
        if (time) {
          const minute = parseInt((time / 60) % 60);
          const second = parseInt(time % 60);
          let minuteText = `${minute}`;
          let secondText = `${second}`;
          if (minute < 10) {
            minuteText = `0${minute}`;
          }
          if (second < 10) {
            secondText = `0${second}`;
          }
          return `${minuteText}:${secondText}`;
        } else {
          return "00:00";
        }
      };

      render() {
        return (
          <div>
            <p>时间：{this.getTime(this.state.currentTime)} / {this.getTime(this.state.duration)}</p>
            <input
              type="button"
              value={this.state.isPlay ? 'PAUSE' : 'PLAY'}
              onClick={this.audioControl}
            />
            <audio
              src="https://music.163.com/song/media/outer/url?id=548967.mp3"
              controls
              ref={ref => this.audio = ref}
            />
          </div>
        )
      }
    }
    
    class MusicList extends React.Component {
      // http://musicapi.leanapp.cn/playlist/detail?id=24381616
      
    }

    ReactDOM.render(
      <AudioPlay />,
      document.getElementById('root')
    )
  </script>
</body>

</html>

<!-- http://musicapi.leanapp.cn/playlist/detail?id=24381616 -->